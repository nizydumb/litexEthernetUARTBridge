# litexEthernetUARTBridge

*A minimal LiteX design for the **Tangâ€¯Primerâ€¯20K** that acts as a **fullâ€‘duplex UARTâ€¯â†”â€¯UDP bridge**. Bytes arriving on the boardâ€™s UART are wrapped into UDP datagrams and sent to the network; incoming UDP payloads are forwarded to UART.*

---

## âœ¨ Project milestones

| Stage | Milestone description | Status |
|-------|-----------------------|--------|
| **1** | Built minimal LiteX design with builtâ€‘in BIOS (generated headers & `linker.ld`) | âœ… |
| **2** | Compiled custom UART firmware with Makefile derived from LiteX *demoâ€‘software* | âœ… |
| **3** | Verified UDP transmission over Ethernet | âœ… |
| **4** | Completed biâ€‘directional **UARTâ€¯â†”â€¯UDP bridge** | âœ… |
| **5** | âœ¨â€¯Planned: replace autogenerated linker/libs with custom ones & create universal Makefile | â³ |

---

## ðŸ“¦ Repository layout
```text
.
â”œâ”€ firmware/          # bareâ€‘metal RISCâ€‘V sources
â”‚   â”œâ”€ main.c         # bridge logic
â”‚   â”œâ”€ uart.c         # handles UART RX, processes lines
â”‚   â”œâ”€ udp.c          # sends/receives UDP datagrams
â”‚   â”œâ”€ linker.ld      # linker script (initially from LiteX BIOS)
â”‚   â””â”€ Makefile       # universal Makefile (from LiteX demo)
â”œâ”€ build/             # generated by LiteX (ignored by git)
â””â”€ README.md          # this file
```

---

## ðŸ›  Prerequisites (tested)

| Tool | Version / Date | Install hint |
|------|----------------|--------------|
| **Python** | 3.10.12 | system / `pyenv` |
| **LiteXÂ &Â Migen** | 2025â€‘04 snapshot (officialÂ Git) | follow LiteX docs |
| **RISCâ€‘VÂ GCC** | riscvâ€‘gnuâ€‘toolchain @â€¯2025â€‘04 | github.com/riscvâ€‘collab/riscvâ€‘gnuâ€‘toolchain |
| **Gowin toolchain** | GowinÂ V1.9.11.01 Education (LinuxÂ x86) | download from Gowin portal |
| **openFPGALoader** | Debian/Ubuntu package `openfpgaloader` | `sudo apt install openfpgaloader` |

All tools are openâ€‘source or freeâ€‘forâ€‘education.

---

## ðŸš€ Quick start

LiteX workflow has **three passes**.

### A â€” build target script to generate headers
```bash
python -m litex_boards.targets.tang_primer_20k --with-ethernet --integrated-rom-size=0x8000 --build
# Ignore the Gowin size warning â€“ we only need the headers.
```

### B â€” build main logic firmware
```bash
cd firmware
make clean && make
```
Generates `firmware/main.bin`.

### C â€” embed firmware, enable Ethernet, flash
```bash
cd ..
python3 -m litex_boards.targets.tang_primer_20k --with-ethernet --integrated-rom-init=firmware/main.bin --build --flash
```

---

### ðŸ› ï¸ Troubleshooting Gowin Qt errors
If the Gowin toolchain on Linux reports missing Qt plugins (e.g. `qt.qpa.plugin: Could not load the Qt platform plugin "xcb" â€¦`), prepend these variables when running the LiteX command:
```bash
QT_QPA_PLATFORM_PLUGIN_PATH=/usr/lib/x86_64-linux-gnu/qt5/plugins QT_QPA_PLATFORM=xcb QT_XCB_GL_INTEGRATION=none python3 -m litex_boards.targets.tang_primer_20k â€¦
```
Adjust the plugin path to suit your distr.

---

### âœ… Verification / Testing
1. **UART âžœ Ethernet**
   * Open a serial terminal (PuTTY, *minicom*, *screen* â€¦) at **115â€¯200 baud**.
   * Type a line and pressÂ **Enter** â€” the board wraps it into a UDP datagram and transmits it.
2. **Ethernet âžœ UART**
   * Add static ARP record to network interface of host machine:
```bash
arp -s 192.168.1.100 02-00-00-00-00-01 192.168.1.101
# 192.168.1.100 - litex board's binded ip address
# 02-00-00-00-00-01 - litex board's binded mac address
# 192.168.1.101 - network interface of host machine 
```
   * Send a UDP packet back with **netcat (ncat)**:
```bash
echo "hello from other planet called Ethernet" | ncat -u 192.168.1.100 1234
# 192.168.1.100 - litex board's binded ip address
# 1234 - litex board's binded udp port
```
   * The text appears immediately in your serial terminal.
3. **Sniff traffic (optional)**
   * Open **Wireshark** on the interface connected to the board.
   * Use display filter, for example `udp.port == 1234` to watch packets in both directions.

---

## ðŸ”§ Configuration knobs

| File | Constants | Purpose |
|------|-----------|---------|
| `main.c` | `MAC_SRC`, `IP_SRC`, `UDP_PORT_SRC` | Boardâ€‘side MAC, IP and UDP **source** port |
| `main.c` | `MAC_DST`, `IP_DST`, `UDP_PORT_DST` | Remote peerâ€™s MAC, IP and UDP **destination** port |

> After editing these values, repeat passes **A â†’ B â†’ C**.

---
